{/* Wellness View mejorada */}
                        {currentView === 'wellness' && (
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">Cuida tu Bienestar</h2>
                                    <div className="text-sm text-gray-600">
                                        Sam está {samMood}
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <button
                                        onClick={startBreathing}
                                        className="bg-blue-100 hover:bg-blue-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="wind" size={24} className="text-blue-600 mx-auto mb-2" />
                                        <p className="text-blue-800 font-medium">Respirar</p>
                                    </button>

                                    <button
                                        onClick={() => setShowMiniGame(true)}
                                        className="bg-green-100 hover:bg-green-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="game" size={24} className="text-green-600 mx-auto mb-2" />
                                        <p className="text-green-800 font-medium">Mini Juego</p>
                                    </button>

                                    <button
                                        onClick={() => setShowMessageSettings(true)}
                                        className="bg-purple-100 hover:bg-purple-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="settings" size={24} className="text-purple-600 mx-auto mb-2" />
                                        <p className="text-purple-800 font-medium">Mensajes</p>
                                    </button>

                                    <button
                                        onClick={() => setShowAddTask(true)}
                                        className="bg-yellow-100 hover:bg-yellow-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="plus" size={24} className="text-yellow-600 mx-auto mb-2" />
                                        <p className="text-yellow-800 font-medium">Agregar Tarea</p>
                                    </button>
                                </div>
                                
                                {/* Configuración de notificaciones */}
                                <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h3 className="text-lg font-medium text-gray-700 mb-3">Configuración de Sam</h3>
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm font-medium text-gray-700">Recordatorios de tareas</p>
                                            <p className="text-xs text-gray-500">Sam te recordará las tareas programadas</p>
                                        </div>
                                        <label className="relative inline-flex items-center cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={showTaskReminders}
                                                onChange={(e) => setShowTaskReminders(e.target.checked)}
                                                className="sr-only peer"
                                            />
                                            <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Breathing Exercise */}
                        {currentView === 'breathing' && (
                            <div className="p-4 text-center">
                                <h2 className="text-xl font-semibold text-gray-800 mb-6">Ejercicio de Respiración</h2>
                                <div className={`w-32 h-32 mx-auto rounded-full breathing-circle ${
                                    breathingPhase === 'inhale' ? 'breathing-inhale' : 'breathing-exhale'
                                }`}></div>
                                <p className="text-lg mt-6 text-gray-700">
                                    {breathingPhase === 'inhale' ? 'Inhala profundamente...' : 'Exhala lentamente...'}
                                </p>
                                <button
                                    onClick={() => {
                                        setBreathingActive(false);
                                        setCurrentView('wellness');
                                    }}
                                    className="mt-6 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors"
                                >
                                    Terminar
                                </button>
                            </div>
                        )}

                        {/* Add Task Modal */}
                        {showAddTask && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-xl p-6 w-full max-w-sm">
                                    <h3 className="text-lg font-semibold mb-4">Agregar Tarea</h3>
                                    
                                    <input
                                        type="text"
                                        placeholder="Título de la tarea"
                                        value={newTask.title}
                                        onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        maxLength="200"
                                    />

                                    <select
                                        value={newTask.type}
                                        onChange={(e) => setNewTask({...newTask, type: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    >
                                        <option value="today">Para hoy</option>
                                        <option value="scheduled">Programada</option>
                                    </select>

                                    {newTask.type === 'scheduled' && (
                                        <>
                                            <input
                                                type="date"
                                                value={newTask.date}
                                                onChange={(e) => setNewTask({...newTask, date: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                            <input
                                                type="time"
                                                value={newTask.time}
                                                onChange={(e) => setNewTask({...newTask, time: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </>
                                    )}

                                    <select
                                        value={newTask.priority}
                                        onChange={(e) => setNewTask({...newTask, priority: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    >
                                        <option value="low">Prioridad Baja</option>
                                        <option value="medium">Prioridad Media</option>
                                        <option value="high">Prioridad Alta</option>
                                    </select>

                                    <div className="flex space-x-3">
                                        <button
                                            onClick={() => setShowAddTask(false)}
                                            className="flex-1 bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-colors"
                                        >
                                            Cancelar
                                        </button>
                                        <button
                                            onClick={addTask}
                                            disabled={!validateInput(newTask.title)}
                                            className="flex-1 bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Agregar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Message Settings Modal */}
                        {showMessageSettings && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-xl p-6 w-full max-w-sm max-h-96 overflow-y-auto">
                                    <h3 className="text-lg font-semibold mb-4">Configurar Mensajes</h3>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Agregar nuevo mensaje inspiracional:
                                        </label>
                                        <input
                                            type="text"
                                            placeholder="Escribe tu mensaje..."
                                            value={newMessage}
                                            onChange={(e) => setNewMessage(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg mb-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            maxLength="200"
                                        />
                                        <button
                                            onClick={addUserMessage}
                                            disabled={!validateInput(newMessage)}
                                            className="w-full bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Agregar
                                        </button>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Tus mensajes personales ({userMessages.length}):
                                        </label>
                                        <div className="max-h-32 overflow-y-auto">
                                            {userMessages.length === 0 ? (
                                                <p className="text-gray-500 text-sm">No hay mensajes personales aún</p>
                                            ) : (
                                                userMessages.map((msg, index) => (
                                                    <div key={index} className="bg-gray-50 p-2 rounded mb-2 text-sm flex justify-between items-center">
                                                        <span className="flex-1">{msg}</span>
                                                        <button
                                                            onClick={() => setUserMessages(prev => prev.filter((_, i) => i !== index))}
                                                            className="ml-2 text-red-500 hover:text-red-700 text-xs"
                                                        >
                                                            <Icon type="close" />
                                                        </button>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setShowMessageSettings(false)}
                                        className="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-colors mt-4"
                                    >
                                        Cerrar
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Mini Game */}
                        {showMiniGame && (
                            <div className="fixed inset-0 bg-gradient-to-br from-blue-400 to-purple-500 flex flex-col items-center justify-center z-50">
                                <div className="text-white text-center mb-4">
                                    <h3 className="text-2xl font-bold mb-2">¡Revienta las Burbujas!</h3>
                                    <p className="text-lg">Puntuación: {gameScore}</p>
                                    <p className="text-sm opacity-75">Burbujas activas: {gameTargets.length}</p>
                                </div>
                                
                                <div className="relative w-80 h-80 bg-white bg-opacity-20 rounded-xl overflow-hidden">
                                    {gameTargets.map(target => (
                                        <button
                                            key={target.id}
                                            onClick={() => popBubble(target.id)}
                                            className={`absolute w-12 h-12 ${target.color} rounded-full opacity-70 hover:opacity-100 transition-opacity animate-bounce`}
                                            style={{
                                                left: `${target.x}%`,
                                                top: `${target.y}%`,
                                            }}
                                        />
                                    ))}
                                </div>

                                <button
                                    onClick={() => {
                                        setShowMiniGame(false);
                                        setGameScore(0);
                                        setGameTargets([]);
                                    }}
                                    className="mt-6 bg-white text-purple-600 px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors"
                                >
                                    Terminar Juego
                                </button>
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        // Renderizar la aplicación cuando todo esté listo
        setTimeout(() => {
            ReactDOM.render(<TaskWellnessApp />, document.getElementById('root'));
        }, 100);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sam - Your Personal Intelligence</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Una conversación que se siente real con tu asistente personal">
    <meta name="theme-color" content="#8B5CF6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Sam">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React CDN - Versiones específicas para mejor compatibilidad -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone@7.23.4/babel.min.js"></script>
    
    <style>
        body {
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        input, textarea, button {
            font-size: 16px;
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .breathing-circle {
            transition: all 4s ease-in-out;
            background: #3B82F6;
        }
        
        .breathing-inhale {
            transform: scale(1.3);
            background: #93C5FD;
        }
        
        .breathing-exhale {
            transform: scale(0.8);
            background: #3B82F6;
        }
        
        html, body {
            overscroll-behavior: none;
        }
        
        /* Iconos inline como fallback */
        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            vertical-align: middle;
        }
        
        .icon-check::before { content: "✓"; }
        .icon-plus::before { content: "+"; }
        .icon-calendar::before { content: "📅"; }
        .icon-clock::before { content: "⏰"; }
        .icon-heart::before { content: "💖"; }
        .icon-wind::before { content: "💨"; }
        .icon-game::before { content: "🎮"; }
        .icon-settings::before { content: "⚙️"; }
        .icon-message::before { content: "💬"; }
        .icon-sparkles::before { content: "✨"; }
        .icon-close::before { content: "✕"; }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #f3e8ff 0%, #e0f2fe 100%);">
            <div style="text-align: center; color: #6b7280;">
                <div style="width: 50px; height: 50px; border: 3px solid #8b5cf6; border-radius: 50%; border-top: 3px solid transparent; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <p>Cargando Sam...</p>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Función helper para localStorage seguro
        const safeLocalStorage = {
            getItem: (key) => {
                try {
                    if (typeof Storage !== "undefined") {
                        return localStorage.getItem(key);
                    }
                    return null;
                } catch (e) {
                    console.warn('localStorage no disponible:', e);
                    return null;
                }
            },
            setItem: (key, value) => {
                try {
                    if (typeof Storage !== "undefined") {
                        localStorage.setItem(key, value);
                        return true;
                    }
                    return false;
                } catch (e) {
                    console.warn('Error guardando en localStorage:', e);
                    return false;
                }
            }
        };
        
        // Función de validación
        const validateInput = (text, minLength = 1, maxLength = 200) => {
            if (!text || typeof text !== 'string') return false;
            const trimmed = text.trim();
            return trimmed.length >= minLength && trimmed.length <= maxLength;
        };
        
        // Componente de icono simple
        const Icon = ({ type, size = 20, className = "" }) => {
            const iconMap = {
                check: "✓",
                plus: "+",
                calendar: "📅",
                clock: "⏰",
                heart: "💖",
                wind: "💨",
                game: "🎮",
                settings: "⚙️",
                message: "💬",
                sparkles: "✨",
                close: "✕"
            };
            
            return (
                <span 
                    className={`inline-block ${className}`}
                    style={{ fontSize: `${size}px`, width: `${size}px`, height: `${size}px` }}
                >
                    {iconMap[type] || "○"}
                </span>
            );
        };
        
        const TaskWellnessApp = () => {
            const [tasks, setTasks] = useState(() => {
                try {
                    const saved = safeLocalStorage.getItem('sam-tasks');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    return [];
                }
            });
            
            const [currentView, setCurrentView] = useState('tasks');
            const [showAddTask, setShowAddTask] = useState(false);
            
            const [inspirationalMessages] = useState([
                "En el ruido del mundo, tu voz interior sigue siendo la más clara",
                "Las preguntas incómodas son las que más necesitamos hacernos",
                "Está bien no encajar en un mundo que no te comprende",
                "Cada momento perdido en el pasado es un presente que no vivimos",
                "Las paredes que construimos para protegernos también nos aíslan",
                "El tiempo corre diferente cuando realmente prestamos atención",
                "Cada crisis es una oportunidad de renacer más auténtico",
                "Los cambios duelen, pero quedarse igual duele más",
                "En el caos interno también hay una música esperando ser descubierta",
                "Seguimos buscando lo que ya llevamos dentro",
                "Las calles del corazón son las más difíciles de caminar",
                "Cada día es una oportunidad de encontrar algo nuevo en nosotros",
                "Puedes cambiar sin perder tu esencia",
                "Los héroes no son perfectos, son valientes",
                "Tu rareza es tu superpoder más auténtico",
                "Imagina la persona que podrías ser si te dieras permiso",
                "La paz comienza en el diálogo contigo mismo",
                "Todos llevamos un soñador dentro esperando despertar"
            ]);
            
            const [userMessages, setUserMessages] = useState(() => {
                try {
                    const saved = safeLocalStorage.getItem('sam-user-messages');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    return [];
                }
            });
            
            const [showMessageSettings, setShowMessageSettings] = useState(false);
            const [newMessage, setNewMessage] = useState('');
            const [currentInspiration, setCurrentInspiration] = useState('');
            const [breathingActive, setBreathingActive] = useState(false);
            const [breathingPhase, setBreathingPhase] = useState('inhale');
            const [showMiniGame, setShowMiniGame] = useState(false);
            const [gameScore, setGameScore] = useState(0);
            const [gameTargets, setGameTargets] = useState([]);
            
            // Sam simplificado - solo notificaciones
            const [samNotification, setSamNotification] = useState('');
            const [samMood, setSamMood] = useState('observando y disponible');
            const [showTaskReminders, setShowTaskReminders] = useState(true);
            
            const [newTask, setNewTask] = useState({
                title: '',
                type: 'today',
                date: '',
                time: '',
                priority: 'medium'
            });
            
            // Referencias para cleanup de intervalos
            const intervalRefs = useRef({
                samCheckIn: null,
                inspiration: null,
                breathing: null,
                miniGame: null,
                taskReminders: null
            });
            
            // Guardar datos en localStorage
            useEffect(() => {
                safeLocalStorage.setItem('sam-tasks', JSON.stringify(tasks));
            }, [tasks]);
            
            useEffect(() => {
                safeLocalStorage.setItem('sam-user-messages', JSON.stringify(userMessages));
            }, [userMessages]);
            
            // Sistema de notificaciones push mejorado
            useEffect(() => {
                if ('serviceWorker' in navigator && 'PushManager' in window) {
                    // Registrar service worker para notificaciones
                    navigator.serviceWorker.register('/sw.js').catch(err => {
                        console.log('Service Worker registration failed:', err);
                    });
                }
            }, []);
            
            // Sam check-in inteligente - pregunta por nuevas tareas
            useEffect(() => {
                if (intervalRefs.current.samCheckIn) {
                    clearInterval(intervalRefs.current.samCheckIn);
                }
                
                intervalRefs.current.samCheckIn = setInterval(() => {
                    // Lógica inteligente para preguntar
                    const now = new Date();
                    const hour = now.getHours();
                    const isWorkingHours = hour >= 9 && hour <= 21;
                    
                    // Solo pregunta en horario laboral y si hay actividad
                    if (isWorkingHours && tasks.length >= 1 && tasks.length < 12) {
                        if (Math.random() < 0.35) { // 35% chance
                            samCheckIn();
                        }
                    }
                }, 25 * 60 * 1000); // Cada 25 minutos
                
                return () => {
                    if (intervalRefs.current.samCheckIn) {
                        clearInterval(intervalRefs.current.samCheckIn);
                    }
                };
            }, [tasks]);
            
            // Recordatorios automáticos para tareas programadas
            useEffect(() => {
                if (intervalRefs.current.taskReminders) {
                    clearInterval(intervalRefs.current.taskReminders);
                }
                
                intervalRefs.current.taskReminders = setInterval(() => {
                    checkTaskReminders();
                }, 60000); // Cada minuto
                
                return () => {
                    if (intervalRefs.current.taskReminders) {
                        clearInterval(intervalRefs.current.taskReminders);
                    }
                };
            }, [tasks]);
            
            // Mensajes inspiracionales
            useEffect(() => {
                if (intervalRefs.current.inspiration) {
                    clearInterval(intervalRefs.current.inspiration);
                }
                
                intervalRefs.current.inspiration = setInterval(() => {
                    const allMessages = [...inspirationalMessages, ...userMessages];
                    if (allMessages.length > 0) {
                        const randomMessage = allMessages[Math.floor(Math.random() * allMessages.length)];
                        setCurrentInspiration(randomMessage);
                        setTimeout(() => setCurrentInspiration(''), 8000);
                    }
                }, 45 * 60 * 1000); // Cada 45 minutos
                
                return () => {
                    if (intervalRefs.current.inspiration) {
                        clearInterval(intervalRefs.current.inspiration);
                    }
                };
            }, [inspirationalMessages, userMessages]);
            
            // Ejercicio de respiración
            useEffect(() => {
                if (breathingActive) {
                    if (intervalRefs.current.breathing) {
                        clearInterval(intervalRefs.current.breathing);
                    }
                    
                    intervalRefs.current.breathing = setInterval(() => {
                        setBreathingPhase(prev => prev === 'inhale' ? 'exhale' : 'inhale');
                    }, 4000);
                } else {
                    if (intervalRefs.current.breathing) {
                        clearInterval(intervalRefs.current.breathing);
                    }
                }
                
                return () => {
                    if (intervalRefs.current.breathing) {
                        clearInterval(intervalRefs.current.breathing);
                    }
                };
            }, [breathingActive]);
            
            // Mini-juego
            useEffect(() => {
                if (showMiniGame) {
                    if (intervalRefs.current.miniGame) {
                        clearInterval(intervalRefs.current.miniGame);
                    }
                    
                    intervalRefs.current.miniGame = setInterval(() => {
                        setGameTargets(prev => {
                            const maxTargets = 5;
                            const newTargets = [...prev];
                            
                            if (newTargets.length >= maxTargets) {
                                newTargets.shift();
                            }
                            
                            newTargets.push({
                                id: Date.now(),
                                x: Math.random() * 80,
                                y: Math.random() * 80,
                                color: ['bg-blue-400', 'bg-green-400', 'bg-yellow-400', 'bg-pink-400'][Math.floor(Math.random() * 4)]
                            });
                            
                            return newTargets;
                        });
                    }, 2000);
                } else {
                    if (intervalRefs.current.miniGame) {
                        clearInterval(intervalRefs.current.miniGame);
                    }
                }
                
                return () => {
                    if (intervalRefs.current.miniGame) {
                        clearInterval(intervalRefs.current.miniGame);
                    }
                };
            }, [showMiniGame]);
            
            // Sam check-in inteligente y mejorado
            const samCheckIn = () => {
                const taskMessages = [
                    "¿Surgió alguna tarea nueva que necesites anotar? 📝",
                    "¿Hay algo que se te ocurrió que tengas que hacer? 🤔",
                    "¿Alguna nueva actividad para agregar a tu lista? ✨",
                    "¿Se te cruzó alguna tarea pendiente por la cabeza? 💭",
                    "¿Hay algo nuevo que tengas que recordar hacer? 🎯",
                    "¿Alguna idea nueva para tu lista de tareas? 💡",
                    "¿Necesitás anotar algo que no querés olvidar? 📋",
                    "¿Hay alguna tarea que se te ocurrió recién? 🚀"
                ];
                
                const randomMessage = taskMessages[Math.floor(Math.random() * taskMessages.length)];
                setSamNotification(randomMessage);
                setSamMood("curiosa y servicial");
                
                // Auto-hide después de 12 segundos
                setTimeout(() => {
                    setSamNotification('');
                }, 12000);
            };
            
            // Sistema de recordatorios para tareas programadas
            const checkTaskReminders = () => {
                const now = new Date();
                const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                const currentDate = now.toISOString().split('T')[0];
                
                tasks.forEach(task => {
                    if (task.type === 'scheduled' && !task.completed && task.date === currentDate) {
                        // Recordatorio 30 minutos antes
                        if (task.time) {
                            const taskTime = new Date(`${task.date}T${task.time}`);
                            const reminderTime = new Date(taskTime.getTime() - 30 * 60000);
                            
                            if (Math.abs(now.getTime() - reminderTime.getTime()) < 60000) {
                                showTaskReminder(task, '30 minutos');
                            }
                            
                            // Recordatorio exacto
                            if (Math.abs(now.getTime() - taskTime.getTime()) < 60000) {
                                showTaskReminder(task, 'ahora');
                            }
                        }
                    }
                });
            };
            
            // Mostrar recordatorio de tarea
            const showTaskReminder = (task, timing) => {
                const reminderMessage = timing === 'ahora' 
                    ? `⏰ Es hora de: ${task.title}`
                    : `🔔 En ${timing}: ${task.title}`;
                
                setSamNotification(reminderMessage);
                setSamMood("recordando tareas");
                
                // Push notification si está disponible
                if ('serviceWorker' in navigator && 'PushManager' in window) {
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification('Sam - Recordatorio', {
                            body: reminderMessage,
                            icon: '/icon-192x192.png',
                            badge: '/icon-192x192.png',
                            vibrate: [200, 100, 200],
                            actions: [
                                { action: 'mark-done', title: 'Completar' },
                                { action: 'snooze', title: 'Posponer' }
                            ]
                        });
                    }).catch(err => {
                        console.log('Push notification failed:', err);
                    });
                }
                
                // Auto-hide después de 15 segundos
                setTimeout(() => {
                    setSamNotification('');
                }, 15000);
            };
            
            const addTask = () => {
                if (validateInput(newTask.title)) {
                    const task = {
                        id: Date.now(),
                        title: newTask.title.trim(),
                        type: newTask.type,
                        date: newTask.date,
                        time: newTask.time,
                        priority: newTask.priority,
                        completed: false,
                        createdAt: new Date().toISOString()
                    };
                    setTasks(prev => [...prev, task]);
                    setNewTask({ title: '', type: 'today', date: '', time: '', priority: 'medium' });
                    setShowAddTask(false);
                }
            };
            
            const toggleTask = (id) => {
                setTasks(prev => prev.map(task => 
                    task.id === id ? { ...task, completed: !task.completed } : task
                ));
            };
            
            const addUserMessage = () => {
                if (validateInput(newMessage)) {
                    setUserMessages(prev => [...prev, newMessage.trim()]);
                    setNewMessage('');
                }
            };
            
            const startBreathing = () => {
                setBreathingActive(true);
                setCurrentView('breathing');
                setTimeout(() => {
                    setBreathingActive(false);
                    setCurrentView('wellness');
                }, 60000);
            };
            
            const popBubble = (id) => {
                setGameTargets(prev => prev.filter(target => target.id !== id));
                setGameScore(prev => prev + 10);
            };
            
            const todayTasks = tasks.filter(task => task.type === 'today');
            const scheduledTasks = tasks.filter(task => task.type === 'scheduled');
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-4">
                    <div className="max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-purple-500 to-blue-500 p-6 text-white">
                            <h1 className="text-2xl font-bold mb-2">Sam</h1>
                            <p className="text-purple-100">Your personal intelligence</p>
                        </div>

                        {/* Mensaje inspiracional */}
                        {currentInspiration && (
                            <div className="fixed top-4 left-4 right-4 bg-yellow-100 border-l-4 border-yellow-400 p-4 rounded-lg shadow-lg z-50 mx-auto max-w-md slide-up">
                                <div className="flex items-center">
                                    <Icon type="heart" className="text-yellow-600 mr-2" />
                                    <p className="text-yellow-800 font-medium">{currentInspiration}</p>
                                </div>
                            </div>
                        )}

                        {/* Mensajes de Sam - Solo notificación simple */}
                        {samMessages.length > 0 && (
                            <div className="fixed top-4 left-4 right-4 bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-200 p-4 rounded-lg shadow-lg z-50 mx-auto max-w-md slide-up">
                                <div className="flex items-start">
                                    <div className="bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">
                                        S
                                    </div>
                                    <div className="flex-1">
                                        <p className="text-gray-800 font-medium">
                                            {samMessages[samMessages.length - 1].message}
                                        </p>
                                        <p className="text-pink-600 text-xs mt-1">
                                            Sam está {samMessages[samMessages.length - 1].mood}
                                        </p>
                                        <div className="flex gap-2 mt-2">
                                            <button
                                                onClick={() => {
                                                    setCurrentView('sam');
                                                    setSamMessages([]);
                                                }}
                                                className="bg-pink-500 text-white px-3 py-1 rounded text-xs hover:bg-pink-600"
                                            >
                                                Chatear
                                            </button>
                                            <button
                                                onClick={() => setSamMessages([])}
                                                className="bg-gray-400 text-white px-3 py-1 rounded text-xs hover:bg-gray-500"
                                            >
                                                OK
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Navigation - Sin Sam Chat */}
                        <div className="flex bg-gray-50 p-1 m-4 rounded-lg">
                            <button
                                onClick={() => setCurrentView('tasks')}
                                className={`flex-1 p-3 rounded-lg flex items-center justify-center ${
                                    currentView === 'tasks' ? 'bg-white shadow-sm text-purple-600' : 'text-gray-600'
                                }`}
                            >
                                <Icon type="check" className="mr-2" />
                                Tareas
                            </button>
                            <button
                                onClick={() => setCurrentView('wellness')}
                                className={`flex-1 p-3 rounded-lg flex items-center justify-center ${
                                    currentView === 'wellness' ? 'bg-white shadow-sm text-purple-600' : 'text-gray-600'
                                }`}
                            >
                                <Icon type="sparkles" className="mr-2" />
                                Bienestar
                            </button>
                        </div>

                        {/* Tasks View */}
                        {currentView === 'tasks' && (
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">Mis Tareas</h2>
                                    <button
                                        onClick={() => setShowAddTask(true)}
                                        className="bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600 transition-colors"
                                    >
                                        <Icon type="plus" />
                                    </button>
                                </div>

                                {/* Tareas de hoy */}
                                <div className="mb-6">
                                    <h3 className="text-lg font-medium text-gray-700 mb-3 flex items-center">
                                        <Icon type="calendar" className="mr-2" />
                                        Hoy
                                    </h3>
                                    {todayTasks.length === 0 ? (
                                        <p className="text-gray-500 text-center py-4">No hay tareas para hoy</p>
                                    ) : (
                                        todayTasks.map(task => (
                                            <div key={task.id} className="flex items-center p-3 bg-gray-50 rounded-lg mb-2">
                                                <button
                                                    onClick={() => toggleTask(task.id)}
                                                    className={`mr-3 ${task.completed ? 'text-green-500' : 'text-gray-400'}`}
                                                >
                                                    <Icon type="check" />
                                                </button>
                                                <span className={`flex-1 ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                                    {task.title}
                                                </span>
                                                <span className={`text-xs px-2 py-1 rounded ${
                                                    task.priority === 'high' ? 'bg-red-100 text-red-600' :
                                                    task.priority === 'medium' ? 'bg-yellow-100 text-yellow-600' :
                                                    'bg-green-100 text-green-600'
                                                }`}>
                                                    {task.priority === 'high' ? 'Alta' : task.priority === 'medium' ? 'Media' : 'Baja'}
                                                </span>
                                            </div>
                                        ))
                                    )}
                                </div>

                                {/* Tareas programadas */}
                                <div>
                                    <h3 className="text-lg font-medium text-gray-700 mb-3 flex items-center">
                                        <Icon type="clock" className="mr-2" />
                                        Programadas
                                    </h3>
                                    {scheduledTasks.length === 0 ? (
                                        <p className="text-gray-500 text-center py-4">No hay tareas programadas</p>
                                    ) : (
                                        scheduledTasks.map(task => (
                                            <div key={task.id} className="flex items-center p-3 bg-gray-50 rounded-lg mb-2">
                                                <button
                                                    onClick={() => toggleTask(task.id)}
                                                    className={`mr-3 ${task.completed ? 'text-green-500' : 'text-gray-400'}`}
                                                >
                                                    <Icon type="check" />
                                                </button>
                                                <div className="flex-1">
                                                    <span className={`block ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                                                        {task.title}
                                                    </span>
                                                    <span className="text-xs text-gray-500">
                                                        {task.date} {task.time && `a las ${task.time}`}
                                                    </span>
                                                </div>
                                                <span className={`text-xs px-2 py-1 rounded ${
                                                    task.priority === 'high' ? 'bg-red-100 text-red-600' :
                                                    task.priority === 'medium' ? 'bg-yellow-100 text-yellow-600' :
                                                    'bg-green-100 text-green-600'
                                                }`}>
                                                    {task.priority === 'high' ? 'Alta' : task.priority === 'medium' ? 'Media' : 'Baja'}
                                                </span>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Wellness View */}
                        {currentView === 'wellness' && (
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">Cuida tu Bienestar</h2>
                                    <div className="text-sm text-gray-600">
                                        Sam está {samMood}
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <button
                                        onClick={startBreathing}
                                        className="bg-blue-100 hover:bg-blue-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="wind" size={24} className="text-blue-600 mx-auto mb-2" />
                                        <p className="text-blue-800 font-medium">Respirar</p>
                                    </button>

                                    <button
                                        onClick={() => setShowMiniGame(true)}
                                        className="bg-green-100 hover:bg-green-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="game" size={24} className="text-green-600 mx-auto mb-2" />
                                        <p className="text-green-800 font-medium">Mini Juego</p>
                                    </button>

                                    <button
                                        onClick={() => setShowMessageSettings(true)}
                                        className="bg-purple-100 hover:bg-purple-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="settings" size={24} className="text-purple-600 mx-auto mb-2" />
                                        <p className="text-purple-800 font-medium">Mensajes</p>
                                    </button>

                                    <button
                                        onClick={() => setShowAddTask(true)}
                                        className="bg-yellow-100 hover:bg-yellow-200 p-4 rounded-lg transition-colors"
                                    >
                                        <Icon type="plus" size={24} className="text-yellow-600 mx-auto mb-2" />
                                        <p className="text-yellow-800 font-medium">Agregar Tarea</p>
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Sam Chat View */}
                        {currentView === 'sam' && (
                            <div className="p-4 h-96 flex flex-col">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">Conversando con Sam</h2>
                                    <div className="text-sm text-gray-600">
                                        {samMood}
                                    </div>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto bg-gradient-to-br from-pink-50 to-purple-50 rounded-lg p-4 mb-4 hide-scrollbar">
                                    {conversationHistory.length === 0 ? (
                                        <div className="text-center text-gray-500 py-8">
                                            <div className="bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4 text-2xl font-bold">
                                                S
                                            </div>
                                            <p className="mb-2">Sam está esperando para conocerte</p>
                                            <p className="text-sm mb-4">Una conversación que se siente real</p>
                                            <button
                                                onClick={() => samCheckIn('initial')}
                                                className="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-6 py-3 rounded-lg hover:from-pink-600 hover:to-purple-600 transition-colors"
                                            >
                                                Conocer a Sam
                                            </button>
                                        </div>
                                    ) : (
                                        conversationHistory.map((msg, index) => (
                                            <div key={index} className={`mb-4 ${msg.role === 'sam' ? 'text-left' : 'text-right'}`}>
                                                <div className={`inline-block p-3 rounded-lg max-w-xs ${
                                                    msg.role === 'sam' 
                                                        ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white' 
                                                        : 'bg-white text-gray-800 shadow-sm'
                                                }`}>
                                                    <p className="text-sm">{msg.content}</p>
                                                    <p className="text-xs mt-1 opacity-70">
                                                        {new Date(msg.timestamp).toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' })}
                                                    </p>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                                
                                {/* Input para mensajes personalizados */}
                                <div className="mb-4">
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={userInput}
                                            onChange={(e) => setUserInput(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            placeholder="Escribe tu mensaje a Sam..."
                                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                                            maxLength="200"
                                        />
                                        <button
                                            onClick={sendCustomMessage}
                                            disabled={!validateInput(userInput)}
                                            className="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-4 py-3 rounded-lg hover:from-pink-600 hover:to-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Enviar
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Respuestas rápidas mejoradas */}
                                <div className="flex gap-2 flex-wrap">
                                    <button
                                        onClick={() => respondToSam("Necesito agregar una tarea nueva")}
                                        className="bg-purple-100 text-purple-800 px-3 py-2 rounded-lg text-sm hover:bg-purple-200"
                                    >
                                        Agregar tarea
                                    </button>
                                    <button
                                        onClick={() => respondToSam("¿Cómo puedo organizarme mejor?")}
                                        className="bg-blue-100 text-blue-800 px-3 py-2 rounded-lg text-sm hover:bg-blue-200"
                                    >
                                        Ayuda organización
                                    </button>
                                    <button
                                        onClick={() => respondToSam("Me siento un poco perdido con mis tareas")}
                                        className="bg-green-100 text-green-800 px-3 py-2 rounded-lg text-sm hover:bg-green-200"
                                    >
                                        Necesito apoyo
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Breathing Exercise */}
                        {currentView === 'breathing' && (
                            <div className="p-4 text-center">
                                <h2 className="text-xl font-semibold text-gray-800 mb-6">Ejercicio de Respiración</h2>
                                <div className={`w-32 h-32 mx-auto rounded-full breathing-circle ${
                                    breathingPhase === 'inhale' ? 'breathing-inhale' : 'breathing-exhale'
                                }`}></div>
                                <p className="text-lg mt-6 text-gray-700">
                                    {breathingPhase === 'inhale' ? 'Inhala profundamente...' : 'Exhala lentamente...'}
                                </p>
                                <button
                                    onClick={() => {
                                        setBreathingActive(false);
                                        setCurrentView('wellness');
                                    }}
                                    className="mt-6 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors"
                                >
                                    Terminar
                                </button>
                            </div>
                        )}

                        {/* Add Task Modal */}
                        {showAddTask && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-xl p-6 w-full max-w-sm">
                                    <h3 className="text-lg font-semibold mb-4">Agregar Tarea</h3>
                                    
                                    <input
                                        type="text"
                                        placeholder="Título de la tarea"
                                        value={newTask.title}
                                        onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        maxLength="200"
                                    />

                                    <select
                                        value={newTask.type}
                                        onChange={(e) => setNewTask({...newTask, type: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    >
                                        <option value="today">Para hoy</option>
                                        <option value="scheduled">Programada</option>
                                    </select>

                                    {newTask.type === 'scheduled' && (
                                        <>
                                            <input
                                                type="date"
                                                value={newTask.date}
                                                onChange={(e) => setNewTask({...newTask, date: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                            <input
                                                type="time"
                                                value={newTask.time}
                                                onChange={(e) => setNewTask({...newTask, time: e.target.value})}
                                                className="w-full p-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </>
                                    )}

                                    <select
                                        value={newTask.priority}
                                        onChange={(e) => setNewTask({...newTask, priority: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    >
                                        <option value="low">Prioridad Baja</option>
                                        <option value="medium">Prioridad Media</option>
                                        <option value="high">Prioridad Alta</option>
                                    </select>

                                    <div className="flex space-x-3">
                                        <button
                                            onClick={() => setShowAddTask(false)}
                                            className="flex-1 bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-colors"
                                        >
                                            Cancelar
                                        </button>
                                        <button
                                            onClick={addTask}
                                            disabled={!validateInput(newTask.title)}
                                            className="flex-1 bg-purple-500 text-white p-3 rounded-lg hover:bg-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Agregar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Message Settings Modal */}
                        {showMessageSettings && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-xl p-6 w-full max-w-sm max-h-96 overflow-y-auto">
                                    <h3 className="text-lg font-semibold mb-4">Configurar Mensajes</h3>
                                    
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Agregar nuevo mensaje inspiracional:
                                        </label>
                                        <input
                                            type="text"
                                            placeholder="Escribe tu mensaje..."
                                            value={newMessage}
                                            onChange={(e) => setNewMessage(e.target.value)}
                                            className="w-full p-3 border border-gray-300 rounded-lg mb-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            maxLength="200"
                                        />
                                        <button
                                            onClick={addUserMessage}
                                            disabled={!validateInput(newMessage)}
                                            className="w-full bg-purple-500 text-white p-2 rounded-lg hover:bg-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Agregar
                                        </button>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Tus mensajes personales ({userMessages.length}):
                                        </label>
                                        <div className="max-h-32 overflow-y-auto">
                                            {userMessages.length === 0 ? (
                                                <p className="text-gray-500 text-sm">No hay mensajes personales aún</p>
                                            ) : (
                                                userMessages.map((msg, index) => (
                                                    <div key={index} className="bg-gray-50 p-2 rounded mb-2 text-sm flex justify-between items-center">
                                                        <span className="flex-1">{msg}</span>
                                                        <button
                                                            onClick={() => setUserMessages(prev => prev.filter((_, i) => i !== index))}
                                                            className="ml-2 text-red-500 hover:text-red-700 text-xs"
                                                        >
                                                            <Icon type="close" />
                                                        </button>
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setShowMessageSettings(false)}
                                        className="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-colors mt-4"
                                    >
                                        Cerrar
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Mini Game */}
                        {showMiniGame && (
                            <div className="fixed inset-0 bg-gradient-to-br from-blue-400 to-purple-500 flex flex-col items-center justify-center z-50">
                                <div className="text-white text-center mb-4">
                                    <h3 className="text-2xl font-bold mb-2">¡Revienta las Burbujas!</h3>
                                    <p className="text-lg">Puntuación: {gameScore}</p>
                                    <p className="text-sm opacity-75">Burbujas activas: {gameTargets.length}</p>
                                </div>
                                
                                <div className="relative w-80 h-80 bg-white bg-opacity-20 rounded-xl overflow-hidden">
                                    {gameTargets.map(target => (
                                        <button
                                            key={target.id}
                                            onClick={() => popBubble(target.id)}
                                            className={`absolute w-12 h-12 ${target.color} rounded-full opacity-70 hover:opacity-100 transition-opacity animate-bounce`}
                                            style={{
                                                left: `${target.x}%`,
                                                top: `${target.y}%`,
                                            }}
                                        />
                                    ))}
                                </div>

                                <button
                                    onClick={() => {
                                        setShowMiniGame(false);
                                        setGameScore(0);
                                        setGameTargets([]);
                                    }}
                                    className="mt-6 bg-white text-purple-600 px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors"
                                >
                                    Terminar Juego
                                </button>
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        // Renderizar la aplicación cuando todo esté listo
        setTimeout(() => {
            ReactDOM.render(<TaskWellnessApp />, document.getElementById('root'));
        }, 100);
    </script>
</body>
</html>
